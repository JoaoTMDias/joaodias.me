---
import { getCollection } from "astro:content";
import Bio from "../components/bio/index.astro";
import Experience from "../components/experience/index.astro";
import Hero from "../components/hero/index.astro";
import Intro from "../components/intro/index.astro";
import Skills from "../components/skills/index.astro";
import Work from "../components/work/index.astro";
import PAGE_CONTENT from "../data/index.json";
import PageLayout from "../layouts/PageLayout.astro";

// Fetch projects from Astro content collections
const allProjects = await getCollection("projects");

// Transform projects to match Work component's expected format
// Sort by date (newest first) and take only the ones that should be featured
const workProjects = allProjects
	.sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
	.map((project) => ({
		id: project.slug,
		title: project.data.title,
		shortDescription: project.data.shortDescription,
		skills: project.data.skills,
		thumbnail: {
			src: project.data.thumbnail.startsWith("/")
				? project.data.thumbnail
				: `/${project.data.thumbnail}`,
			width: 123, // Default width, can be enhanced later
			height: 123, // Default height, can be enhanced later
			alt: `${project.data.title} project thumbnail`,
		},
		theme: {
			background: project.data.themeBackground || "#000000",
			foreground: project.data.themeForeground || "#ffffff",
		},
	}));

const workData = {
	title: PAGE_CONTENT.work.title,
	description: PAGE_CONTENT.work.description,
	data: workProjects,
};
---

<PageLayout title={PAGE_CONTENT.title} description="JoÃ£o Dias">
	<main>
		<Hero />
		<section id="content" tabindex={-1} aria-labelledby="about">
			<h2 id="about" class="sr-only">{PAGE_CONTENT.about.title}</h2>
			<Intro />
			<Skills />
			<Bio />
			<Experience />
		</section>
		<section class="section" aria-labelledby="work">
			<Work title={workData.title} description={workData.description} data={workData.data} />
		</section>
	</main>
</PageLayout>

<style lang="scss">
	.section,
	section {
		display: flex;
		flex-direction: column;
		min-height: 100vh;
		padding-block: 10vh;
		padding-inline: 1rem;
		margin: 0 auto;
		max-width: 100vw;

		@media (min-width: 60rem) {
			padding-block: 6rem;
			padding-inline: 3rem;
			max-width: 75rem;
		}
	}
</style>
